---
title: "Third Draft"
output: html_document
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Functions

This will also load the parts of the tidyverse we need.

```{r}
library(dplyr)
library(tidyr)
library(ggplot2)
library(purrr)
library(doParallel)
source("simulation_functions.R")
```

## Setup Initial Conditions

```{r}
x1_initial_values <- data.frame(x1 = c(0.75, 1, 1.25))
x2_initial_values <- data.frame(x2 = c(0.75, 1, 1.25))
x3_initial_values <- data.frame(x3 = c(0.75, 1, 1.25))
x4_initial_values <- data.frame(x4 = c(0.75, 1, 1.25))
x5_initial_values <- data.frame(x5 = c(0.75, 1, 1.25))

initial_condition_df <- crossing(
  x1_initial_values, 
  x2_initial_values, 
  x3_initial_values,
  x4_initial_values,
  x5_initial_values
)
```

## Turn Each Row Into a Vector

```{r}
ics <- vector(mode = "list", length = nrow(initial_condition_df))

for (i in 1:nrow(initial_condition_df)) {
  initial_condition_vec <- vector(mode = "numeric", length = length(initial_condition_df))
  
  initial_condition_vec[1] <- initial_condition_df[i, "x1"]
  initial_condition_vec[2] <- initial_condition_df[i, "x2"]
  initial_condition_vec[3] <- initial_condition_df[i, "x3"]
  initial_condition_vec[4] <- initial_condition_df[i, "x4"]
  initial_condition_vec[5] <- initial_condition_df[i, "x5"]
  
  ics[[i]] <- initial_condition_vec
}
```

## Use mclapply to Create All Plots

```{r}
# cl <- makeCluster(3, type='PSOCK')
cl <- makeCluster(4, type='PSOCK')
registerDoParallel(cl)

initial_condition_plots <- foreach(i=1:length(ics), .packages = "tidyverse") %dopar% {
  initial_conditions_run_and_plot(
    x1_initial = ics[[i]][[1]],
    x2_initial = ics[[i]][[2]],
    x3_initial = ics[[i]][[3]],
    x4_initial = ics[[i]][[4]],
    x5_initial = ics[[i]][[5]]
  )
}

# turn parallel processing off and run sequentially again:
registerDoSEQ()
```

## Try One of the Plots?

```{r}
initial_condition_plots[[100]]
```
