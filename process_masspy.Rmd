---
title: "Analyze MASSpy Output"
author: "Alicia Key"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load the libraries

```{r}
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
```

## Set a plot theme

```{r}
theme_set(theme_linedraw())
```

## Flux data

### Load it

```{r}
flux_sol <- read_csv(here("input", "flux_trajectories.csv"))
```

### Pivot longer

```{r}
flux_long <- flux_sol %>%
  pivot_longer(-time_hr, names_to = "flux", values_to = "mM_per_hr")

head(flux_long)
```

### Find CVs of all fluxes

```{r}
flux_stats <- flux_long %>%
  group_by(flux) %>%
  summarize(cv = sd(mM_per_hr) / mean(mM_per_hr), max_mM_per_hr = max(mM_per_hr)) %>%
  arrange(desc(cv))

head(flux_stats, n = 5)
```

### Plot the Top 5 Fluxes

```{r}
top_5_fluxes <- head(flux_stats$flux, n = 5)

flux_long %>%
  filter(flux %in% top_5_fluxes) %>%
  ggplot(aes(x = time_hr, y = mM_per_hr, color = flux)) +
  geom_line()
```
