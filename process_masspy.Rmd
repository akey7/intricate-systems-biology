---
title: "Analyze MASSpy Output"
author: "Alicia Key"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load the libraries

```{r}
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
```

## Set a plot theme

```{r}
theme_set(theme_linedraw())
```

## Flux data

### Load it

```{r}
flux_sol <- read_csv(here("input", "flux_trajectories.csv"))
```

### Pivot longer

```{r}
flux_long <- flux_sol %>%
  pivot_longer(-time_hr, names_to = "flux", values_to = "mM_per_hr")

head(flux_long)
```

### Find CVs of all fluxes

```{r}
flux_stats <- flux_long %>%
  group_by(flux) %>%
  summarize(cv = sd(mM_per_hr) / mean(mM_per_hr), max_mM_per_hr = max(mM_per_hr)) %>%
  arrange(desc(cv))

head(flux_stats, n = 5)
```

### Plot the Top 5 Fluxes

```{r}
top_5_fluxes <- head(flux_stats$flux, n = 5)

flux_long %>%
  filter(flux %in% top_5_fluxes[2:5]) %>%
  ggplot(aes(x = time_hr, y = mM_per_hr, color = flux)) +
  geom_line()
```

## Concentration Data

### Load the data

```{r}
concentration_trajectories = read_csv(here("input", "concentration_trajectories.csv"))
```

### Prepare the data

```{r}
concentration_long <- concentration_trajectories %>%
  pivot_longer(-time_hr, values_to = "mM", names_to = "metabolite")
```

### Plot the data

```{r}
concentration_stats <- concentration_long %>%
  group_by(metabolite) %>%
  summarize(cv = sd(mM) / mean(mM)) %>%
  arrange(desc(cv))

top_5_concentrations <- head(concentration_stats$metabolite, n = 5)

concentration_long %>%
  filter(metabolite %in% top_5_concentrations[3:5]) %>%
  ggplot(aes(x = time_hr, y = mM, color = metabolite)) +
  geom_line()
```
